const PLANET_ICON = `ü™ê`;

let logoY = 100;
let logoX = 100;
let xSpeed = 5;
let ySpeed = 5;

let setupHasRun = false;

function setup() {
  if (shouldDisplay()) {
    setupHasRun = true;
    let scale = window.devicePixelRatio;
    canvas = document.getElementById("background");
    canvasContext = canvas.getContext("2d");

    canvas.width = Math.floor(window.innerWidth * scale);
    canvas.height = Math.floor(window.innerHeight * scale);
    canvasContext.scale(scale, scale)

    drawBackground();
    draw()
    setInterval(draw, 20);
  }
}

function draw() {
  if (shouldDisplay()) {
    clearForeground();
    drawForeground();
  }
}

function clearForeground() {
  const canvas = document.getElementById("foreground");
  const canvasContext = canvas.getContext("2d");
  canvasContext.clearRect(0, 0, canvas.width, canvas.height);
  const scale = window.devicePixelRatio;
  canvas.width = Math.floor(window.innerWidth * scale);
  canvas.height = Math.floor(window.innerHeight * scale);
  canvasContext.scale(scale, scale)
}

function drawBackground() {
  const canvas = document.getElementById("background");
  const canvasContext = canvas.getContext("2d");
  canvasContext.font = "10px/10px \"EnvyCodeR Nerd Font Mono\"";
  canvasContext.fillStyle = "white";

  var lines = nightSky.split('\n');

  textHeight = 10;
  drawHeight = 0;

  var i = 0;
  while (drawHeight < canvas.height) {
    var line = lines[(i % (lines.length - 2)) + 1].slice(0, canvas.width / 10);
    let width = canvasContext.measureText(line).width;
    let lineStart = 0;
    canvasContext.fillText(line, lineStart, drawHeight);
    while (width < canvas.width) {
      lineStart += width;
      width += canvasContext.measureText(line).width;
      canvasContext.fillText(line, lineStart, drawHeight);
    }
    console.log("Line width: ", width);
    drawHeight += textHeight;
    i++;
  }
}

function drawForeground() {
  const canvas = document.getElementById("foreground");
  const canvasContext = canvas.getContext("2d");
  canvasContext.font = "50px/50px \"EnvyCodeR Nerd Font Mono\"";
  canvasContext.fillStyle = "white";

  let textWidth = 50;
  let textHeight = 50;

  if (logoX + textWidth > window.innerWidth || logoX < 0) {
    xSpeed = -xSpeed;
  }
  if (logoY > window.innerHeight || (logoY - textHeight) < 0) {
    ySpeed = -ySpeed;
  }

  logoX += xSpeed;
  logoY += ySpeed;

  canvasContext.fillText(PLANET_ICON, logoX, logoY);
}

function handleResize() {
  if (shouldDisplay() && !setupHasRun) {
    setup();
  }
  var canvas = document.getElementById("foreground");
  var canvasContext = canvas.getContext("2d");

  var scale = window.devicePixelRatio;
  canvas.width = Math.floor(window.innerWidth * scale);
  canvas.height = Math.floor(window.innerHeight * scale);
  canvasContext.scale(scale, scale)

  canvas = document.getElementById("background");
  canvasContext = canvas.getContext("2d");

  canvas.width = Math.floor(window.innerWidth * scale);
  canvas.height = Math.floor(window.innerHeight * scale);
  canvasContext.scale(scale, scale)
  drawBackground();
}


function shouldDisplay() {
  let background = document.getElementById("background");
  return getComputedStyle(background, null).display != "none";
}

window.addEventListener("load", setup);
window.addEventListener('resize', handleResize);

const nightSky = `
                                                                              ‚ú¶                                                                                                                                                                     ‚òÜ                                                                       ‚òÖ                                                                                                                                                  ‚ú¶                                                                                                                                                ¬∞                                                                              ‚Ä¢                                                                        ‚Ä¢                     ‚òÜ                                                                                          ‚ú¶                                                                                                       ¬∞                      
             ‚Ä¢                                                                                                                     ‚òÖ                                                                                                                       ‚ú¶                                                                               ‚òÖ                                                                                     ‚òÖ                                                                       ‚òÖ                                                                        ‚òÖ                                                                          ‚òÜ                                                                                                                                                                         ‚òÖ                                                                                       ‚òÖ                                                                                                        
                                                                                                    ‚ú¶                                                                                                                ‚òÖ                                                            ¬∞                                                                                                                           ‚ú¶                                                                                                                                                             ¬∞                                                                                                                                                                ‚ú¶                                                                                                                                                                                ‚ú¶                                                                                         ‚ú¶               
                                                                                         ‚òÖ                                                          ‚òÜ                                                                                                                            ‚òÜ                                                                                                      ‚òÜ                                                                                                                                                                         ‚òÖ                                                                                                                                      ‚òÖ                                                                                                                                                                   ‚òÜ                                                                                                                                                        ¬∞ 
                            ‚Ä¢                                                                                                                                                       ¬∞                                                                     ‚òÖ                                                                         ¬∞                                                                                                                      ‚Ä¢                                       ‚òÜ                                                                                                                                                                      ¬∞                   ‚Ä¢                                                                  ¬∞                                                                                                                                   ‚òÖ                                                                                                                                  
                                                 ¬∞                                                                                                                 ¬∞                                                                                                                                                          ‚Ä¢                                                                                               ‚ú¶                                                       ‚òÖ      ‚Ä¢                                        ‚Ä¢     ¬∞                                                                                                                                        ‚ú¶                                                                                      ¬∞                                                                                           ‚ú¶                                                                                                 ‚ú¶                                                   ¬∞         
                                                                                     ‚ú¶                                                                                                          ‚Ä¢                                                            ‚ú¶                                                                                                                                    ‚òÖ                                                                                                                          ‚òÖ                                                                                        ‚òÖ                                                                          ¬∞                                                                                                 ‚ú¶                                                                                                       ‚òÜ                                                                                                        ‚òÜ                   
                   ‚òÜ                                                                                                                                                        ‚ú¶                                                                    ‚òÜ                                                                                                           ¬∞                               ‚òÖ                                                                                              ¬∞                                                                                                  ‚ú¶                                            ‚òÖ                                                                                                                            ‚òÜ                                                                                                                                                       ‚ú¶                                                                                                      
                            ¬∞                                                                                                                                                                  ‚òÜ                                                                                                                             ‚Ä¢                                          ‚ú¶                                                                                                          ‚òÜ                                                                           ‚òÜ                                                                                                                              ‚ú¶                                                                ‚Ä¢                                                                                                                                                                             ‚ú¶                                                                       ‚òÜ                  
  ‚ú¶                                                                                                                            ‚Ä¢                                                                           ¬∞                                                                                               ¬∞                                                                ‚òÜ                                                   ‚òÜ                                                                                                                                                                                               ‚òÜ                                                 ‚ú¶                                                                                                                                       ‚òÖ                                                                                            ‚òÜ                                                                        ‚ú¶                                       
                                                    ‚Ä¢                                                                                                                                                                          ‚Ä¢                                                                                                                                                     ¬∞                                                               ‚ú¶                         ‚òÜ                                                                                                                  ‚òÜ                                                                   ¬∞                                                                                 ‚Ä¢                                                                                                                                           ¬∞                                                          ¬∞                                                                        
              ‚Ä¢                                                                                                                                 ‚ú¶                                                                                             ¬∞                                                                                                                   ‚Ä¢                                             ‚ú¶                                                                                                       ‚ú¶                                                                   ‚Ä¢                                                                                                              ‚Ä¢                                                                                                           ‚òÖ                                                           ‚Ä¢                                                                                                   ‚òÖ                                                
                                                                          ‚òÖ                                                                                               ‚òÜ                                                                                                                                  ‚Ä¢                                                                                    ‚Ä¢                                                ‚òÜ                                       ¬∞                                                 ‚Ä¢                                                                                                                                                     ¬∞                                                                                             ‚òÖ                                                                                                                                          ‚ú¶                                 ‚ú¶                                                        ‚òÖ
                                           ¬∞                                                                                             ‚òÜ                                           ‚ú¶                                  ‚Ä¢                                                                                                                                                       ¬∞                                                                                                         ‚Ä¢                                         ‚Ä¢                                                                                                                                                               ‚òÖ     ‚òÜ                                                                                                           ‚ú¶                                                                                                      ¬∞                  ¬∞                                                                                       
                                                   ‚òÜ                                                                                                      ‚Ä¢                                                                      ¬∞                                                                                           ‚òÖ                                                                                                                            ‚Ä¢                                                                                                                  ‚òÖ                                                   ‚Ä¢                                                                                                                                           ¬∞                                                               ‚òÖ                                                                                  ‚ú¶                                                                   ‚Ä¢                                   
             ‚Ä¢                               ¬∞                                                      ‚Ä¢                                                                                                                                     ‚Ä¢                                                                                                                                      ‚òÜ                                                                                                                                                                 ‚Ä¢                                                                                                       ¬∞                                                                                                                                                             ‚òÖ                                                                                                 ‚òÖ                                                                                                            
                                                         ‚òÖ                                                       ‚òÖ                                         ‚òÜ                                                                                                                                                                                       ¬∞                              ‚òÖ                                                                                                                                       ‚òÖ                                                                                           ‚ú¶                                   ‚òÖ                                                                                      ‚ú¶                                                                                               ‚òÜ                                                                                                                  ‚Ä¢                                                                   
            ‚Ä¢                                                                               ¬∞                                            ‚Ä¢                                                                                                                                     ¬∞                                      ‚òÖ                                                                              ‚ú¶                                                                                             ‚ú¶                                                                                                                                    ‚ú¶                                 ‚ú¶                                                                                  ‚òÖ                                                                                                                                ‚òÖ                                                                                                          ‚òÖ                              
                                                                                                   ¬∞                                               ‚òÖ                                                                 ‚òÜ                                                                           ‚Ä¢                                                                                                                                                                ‚òÖ                                       ‚òÖ                                                                                                  ‚òÖ                                                                                                                                                     ‚òÖ                                                                                                                       ‚Ä¢                                                                                      ‚Ä¢                                                     
                                                                                ‚òÖ                                                                              ‚òÖ                                                                                                                                                    ‚ú¶                                                                                  ‚òÖ                                                                                                                         ‚Ä¢                                                                ‚ú¶                                                                                               ‚Ä¢                                                                                                                                                                       ‚òÖ                                                                                     ‚ú¶                                                                       
                                                           ‚òÖ                                                            ‚òÖ                                                                                                                                             ‚òÖ                                                                      ¬∞                                                                     ‚ú¶                                  ‚òÖ                                                                               ‚Ä¢                                                                     ¬∞                                                                                                     ‚ú¶                                                                                ‚òÖ                                                                                                                                               ‚òÖ                                                                                    
                                                                 ‚Ä¢                                                              ¬∞                                                                                                                                                             ¬∞                              ‚Ä¢                                                                                                        ‚òÜ                                                                                                                   ‚òÜ                                                                                                                                      ‚òÖ                                               ‚òÜ                                                                                        ¬∞                                                                                         ‚òÜ                                                                                                   
 ‚Ä¢                                                                                                                          ‚òÜ                                                                                                                                                               ‚Ä¢                                                                                                        ‚Ä¢                                                                                              ‚òÜ                                                                                                                                                                         ¬∞                                                  ‚ú¶                                                                                                 ‚Ä¢                                                                                                               ‚ú¶                                                                 ‚Ä¢                  
             ‚ú¶                                                                                                           ‚Ä¢                                                                                                                                                                                              ‚òÜ                                                                                                                                                                  ¬∞                ¬∞                                                                                                       ‚ú¶                                                                                                                                                                                      ‚òÜ                                                                            ‚Ä¢                                                                                   ‚ú¶                                                           
                                          ‚ú¶                                                                                                                                                                                                 ‚ú¶                                                                                                   ‚ú¶                                                                                                 ‚ú¶                            ¬∞                                                 ‚Ä¢                                                                                                                                                               ‚òÜ                                                                                                                                ‚ú¶                                                                                    ‚òÖ                                                                                                  ‚ú¶             
                                ‚òÖ                                                                                                           ‚òÖ                                                                                               ‚ú¶                                                                                                       ¬∞                                                                                                ‚ú¶                                                                                                          ‚òÖ                                                                                                  ¬∞                                            ‚Ä¢                                                                                                                       ¬∞                                            ‚òÜ                                                                                                                                                  
          ¬∞                                                                                                                                                                       ‚òÖ                                                                                                                                                     ‚ú¶                                                                                            ¬∞                                                                                                                        ¬∞                                                                                                                                                                          ‚òÜ                                                                                               ‚ú¶                                                                                                                                                       ‚òÜ                                      
          ‚Ä¢                                                                                                       ‚òÜ                                                                                                              ‚òÖ                                                                                                           ¬∞                                                                                                                                    ‚òÜ                                                            ‚òÖ                                                                                                                                                                                    ‚òÜ                                          ¬∞                                                           ‚ú¶                                                                                                                                     ‚ú¶                                                      
              ¬∞                                  ‚òÖ                                                                                                        ¬∞                                                                                                      ‚òÜ                                                                                                                                                                                    ‚òÜ                                                                                                                                                          ‚òÜ                                                                                                                      ‚Ä¢                                                                   ‚òÜ                                                                 ¬∞                                                                                                                             ‚òÖ                           
                                                                ‚òÖ                                                                                                            ‚Ä¢                                                                                            ¬∞                                                                                                                 ‚òÖ                                                                                                                                                        ‚òÜ                                         ‚òÖ                                                                                                                                         ‚Ä¢                                                                                     ‚ú¶                                                                                                         ‚ú¶                                                                                              
                                   ‚òÖ                                                       ‚Ä¢                                                                                                                        ‚òÜ                                          ‚Ä¢                                                                                                                                                                            ‚Ä¢                                                                                                             ‚òÜ                                                                   ‚Ä¢                                                                                         ‚Ä¢                                                                ‚ú¶                                                                                                                                              ‚Ä¢                                                                                    ‚òÖ          
                                                                        ‚òÜ                                                                                                                             ‚òÖ                                         ‚òÖ                                                                   ‚òÖ      ‚òÖ                                                                 ‚Ä¢                                                                                                     ‚òÜ                                      ¬∞                                                                                                                   ¬∞                            ‚òÜ                                                                                                ‚òÖ                                                                                                                                                                                          ‚Ä¢                                                
                        ‚ú¶                                                                                            ‚ú¶                                                                                                             ‚ú¶                                                                                                                                    ‚Ä¢                                                                     ¬∞                                                                                                ‚ú¶                                                                                          ‚ú¶                                                                                                                               ‚òÜ                                                                                                                                                                         ‚Ä¢                                                                                   
                                                     ‚òÖ                                                         ¬∞                                          ¬∞                                             ‚ú¶                                                                                           ‚Ä¢                                                                                                                                            ‚òÖ                                                      ‚òÖ                                                  ‚ú¶                                                                                                                                                            ‚ú¶                                                                                                                              ‚Ä¢                             ‚Ä¢                                                                                                                      ‚òÖ                           
                                             ‚òÜ                                                                                                               ‚Ä¢                                                                                                                                                                             ¬∞                                                                                                             ‚òÖ                                                          ‚òÜ                                                                                                                        ‚òÜ                                        ‚òÜ                                                                                                                           ¬∞                                                                                                                                                                     ‚Ä¢                                               
                                                                                                   ‚Ä¢                                                                                              ¬∞                                                           ¬∞                                                                                               ‚òÖ                                           ‚òÖ                                                                                                                                                                                     ‚Ä¢                                                                                                                                             ‚ú¶                                                           ‚òÜ                                                                                                                                                          ‚ú¶                                                                  
                          ‚òÜ                                                                                     ‚ú¶                                                                         ‚ú¶                                                                                 ‚òÜ                                                                                                                                                                                             ¬∞                                                                                                                                                 ¬∞                                                                                                                    ‚ú¶                                                                                                                                      ¬∞                                                                               ¬∞                                                               
                                                                                           ‚ú¶                                                                                               ‚òÜ                                                                                              ‚òÖ                                                                  ‚òÜ                                                                  ‚òÖ                                                                                                                    ‚ú¶                                                                                                      ¬∞                                                                                                                            ‚òÖ                                                                  ‚Ä¢                                       ‚òÜ                                                                                                         ‚Ä¢                         
                                                                                     ‚òÜ                                                                                                                                                                     ¬∞                                                                                                               ‚Ä¢                                                                                                ‚òÜ                                                                                        ¬∞                                                                                                                                                           ‚ú¶                                                                                                                                                       ‚òÖ                                                                                                                                      ‚òÜ       
                                                    ¬∞                                                                                                                                        ‚òÜ                                                                                                        ‚òÜ                                                                                              ‚Ä¢                                                                                                                           ¬∞                                                                                                                                       ‚Ä¢                                                                 ¬∞                                                                    ‚Ä¢                                                                                                                                                              ¬∞                           ‚òÖ                            
                                          ‚Ä¢                                                                      ‚òÖ                                                                                     ¬∞           ¬∞                                                                                                                      ‚òÖ                                                                                                                              ‚ú¶                                                       ¬∞                                                                      ‚òÜ                               ‚òÜ                                                                                                                             ‚òÖ                                                                                                    ¬∞                                                                                                           ¬∞                                                
                                                                                 ‚òÜ                                                                                                                   ¬∞                                                                                                                                                                                            ‚òÜ                               ‚ú¶        ‚òÜ                                                                                                                                                                                        ‚òÜ                                                                    ‚ú¶                                                  ¬∞                          ‚òÖ                                                                                                                                                 ‚òÜ                                                                                              
        ‚òÜ                                                                  ¬∞                                                                                    ‚ú¶                                                                                      ‚ú¶                                                                              ‚òÜ                        ‚òÜ                                                                            ‚òÖ                                                                                                                   ‚òÖ                                                                                                                                                     ‚ú¶                                                                                                                               ¬∞                                                                                                            ‚Ä¢                                                                    
                                                 ‚òÖ                                                                                                                                                    ‚òÜ                                                                                                                               ‚ú¶                                                                                                                                                  ‚òÜ                                                        ‚òÜ                                                                                                                                                                         ‚òÖ                                                      ‚Ä¢                                        ‚òÜ                                                                                                                                                                ‚òÜ                                          
                                                        ¬∞                                                                                                                                            ¬∞                                                                                                                       ‚òÖ                                                                                                                                                          ‚ú¶                                        ‚Ä¢                                                                                                                                                                 ‚òÖ                                                                                                                                                ‚òÖ                                                                                                              ‚òÖ                                                                    
                                                                  ‚Ä¢                                                                    ‚ú¶                                                                                                                                                                     ‚òÖ                                                       ‚Ä¢                                                                                                        ‚Ä¢                                                                               ¬∞                                                                                                                                             ‚òÜ                                       ‚òÖ                                                                                                                                                ‚Ä¢                                                            ‚òÜ                                                                     
                                  ‚ú¶                                      ‚Ä¢                                                                     ‚òÖ                                                                        ‚òÜ                                                                                                                                                       ‚òÜ                                                                                                                                ‚ú¶                                                                                                                                                            ‚òÖ                                                                                ‚òÜ                                                                                                        ‚òÜ                              ‚Ä¢                                                                     ‚òÜ                                                          
                                                         ‚òÖ                                                                        ‚ú¶                                                                                                                                                                                 ‚òÜ                                                                                                                                                ‚òÜ                                                                                                                                            ‚òÜ                                                                            ¬∞                                                                       ‚Ä¢                                                                                                                 ‚òÜ                                                                                                           ‚Ä¢                                  
                    ‚Ä¢                                                   ‚òÖ                                                                                                                           ‚òÖ                                                                                                ¬∞                                                                                                                                                              ¬∞                                                    ‚òÜ                                     ‚òÖ                                                                                           ‚òÖ                                                       ‚òÜ                                                                        ‚òÜ                                                              ¬∞                                                                                     ‚ú¶                                                                                      
                     ‚òÖ                                                                                                        ¬∞                                                                                                            ‚Ä¢                                                                                                         ‚òÜ                                                                                                              ¬∞                                                                    ‚òÖ                                                                                                                                                                 ‚òÖ                                                                                                                                                                                        ‚òÖ                                                                                    ‚Ä¢                                              
`
